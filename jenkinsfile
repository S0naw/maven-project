pipeline
{
agent any
    stages
    {
        stage('scm checkout'){
            steps{
                git branch: 'master', url: 'https://github.com/S0naw/maven-project.git'
            }
        }
        stage('execute umit test framework'){
            steps{
                withMaven(globalMavenSettingsConfig: '698151fa-e8b6-4fcf-bddc-4255f5a16ce1', jdk: 'localjdk', maven: 'LocalMaven', mavenSettingsConfig: 'a83dad05-7b05-475a-9f84-4a43c63e5487', traceability: true) {
   sh 'mvn test'
}
            }
         }
stage('build the code'){
            steps{
                withMaven(globalMavenSettingsConfig: '698151fa-e8b6-4fcf-bddc-4255f5a16ce1', jdk: 'localjdk', maven: 'LocalMaven', mavenSettingsConfig: 'a83dad05-7b05-475a-9f84-4a43c63e5487', traceability: true) {
   sh 'mvn package'
}
            }
        }
stage('docker image creation')
{
steps{ sh 'docker build -t sonaw/tomcat2023:latest .'}
}
stage('docker push to docker registry')
{
steps{
withDockerRegistry(credentialsId: 'ecr:ap-south-1:aws credential', url: '269471964451.dkr.ecr.ap-south-1.amazonaws.com/myregistry') {
    sh 'docker build -t 269471964451.dkr.ecr.ap-south-1.amazonaws.com/myregistry:latest .'
    sh 'docker push 269471964451.dkr.ecr.ap-south-1.amazonaws.com/myregistry:latest'
}}
}
}
}

